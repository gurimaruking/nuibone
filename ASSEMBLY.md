# NuiBone 組み立てガイド

## 必要な部品

### 電子部品

| 部品 | 型番/仕様 | 数量 | 参考価格 |
|------|-----------|------|----------|
| マイコン | ESP32-C3-DevKitM-1 | 1 | ¥800 |
| サーボ | SG90 (9g マイクロサーボ) | 3 | ¥300×3 |
| 電池ホルダー | 単3×3本用 スイッチ付き | 1 | ¥150 |
| 単3電池 | アルカリ乾電池 | 3 | - |
| ネオジム磁石 | φ5×2mm | 4 | ¥200 |
| 配線材 | AWG26程度 | 適量 | ¥200 |

### 3Dプリント部品

| 部品名 | ファイル | 数量 | サポート |
|--------|----------|------|----------|
| 胴体フレーム | body_frame.scad | 1 | 一部必要 |
| 腕ボーン | arm_bone.scad | 2 | 不要 |
| クランクアーム | breathing.scad | 1 | 不要 |
| プッシュロッド | breathing.scad | 1 | 不要 |
| 胸プレート | breathing.scad | 1 | 不要 |
| 脚ボーン | foot.scad | 2 | 不要 |
| 足裏 | foot.scad | 2 | 不要 |

### 工具

- はんだごて、はんだ
- ニッパー
- ピンセット
- 精密ドライバー
- 瞬間接着剤
- 熱収縮チューブ

---

## Step 1: 3Dプリント

### プリント設定

- **フィラメント**: PLA
- **レイヤー高さ**: 0.2mm
- **インフィル**: 20%
- **壁厚**: 1.2mm (3周)
- **サポート**: 胴体フレームのみ必要

### 印刷手順

1. `print_plate.scad` をOpenSCADで開く
2. STLにエクスポート
3. スライサーで設定後、印刷

### 印刷後の処理

1. サポート材を丁寧に除去
2. 穴にフィラメントが残っていたらドリルで除去
3. サーボマウント部分が滑らかか確認

---

## Step 2: サーボの準備

### 2-1. 配線の加工

1. SG90の配線を必要な長さにカット（約10cm推奨）
2. 被覆を5mm剥く
3. 3本のサーボのGND線（茶）を束ねてはんだ付け
4. 3本のサーボのVCC線（赤）を束ねてはんだ付け
5. 各信号線（橙）は個別に残す

### 2-2. サーボホーンの加工

1. SG90付属の十字ホーンを使用
2. 腕ボーンに合わせてホーンをカット（必要に応じて）

---

## Step 3: 胴体フレームの組み立て

### 3-1. 肩サーボの取り付け

1. 左肩マウントにサーボを差し込む
   - 出力軸が外側を向くように
2. サーボフランジをマウントにはめる
3. 右肩も同様に取り付け

### 3-2. 呼吸サーボの取り付け

1. 胴体中央のマウントにサーボを差し込む
2. 出力軸が上を向くように設置
3. 配線を背骨の溝に沿わせて固定

---

## Step 4: 腕の組み立て

### 4-1. 腕ボーンの取り付け

1. サーボホーンにネジで腕ボーンを固定
2. ホーンをサーボ出力軸に押し込む
3. 中心位置で腕が水平になるよう調整
4. 付属のネジでホーンを固定

### 注意

- **左右で向きが逆になる**ことを確認
- サーボを90度の状態で取り付ける

---

## Step 5: 呼吸機構の組み立て

### 5-1. クランクアームの取り付け

1. クランクアームをサーボ出力軸に取り付け
2. Dカット部分をしっかり合わせる
3. ネジで固定

### 5-2. プッシュロッドの接続

1. プッシュロッドをクランクアームの穴に差し込む
2. 軽く動くことを確認

### 5-3. 胸プレートの取り付け

1. プッシュロッドの上端を胸プレートに差し込む
2. スムーズに上下することを確認

---

## Step 6: 足の組み立て

### 6-1. 脚の取り付け

1. 脚ボーンを胴体フレームの腰部に差し込む
2. 軽く瞬間接着剤で固定（取り外し可能にしたい場合は不要）

### 6-2. 足裏の組み立て

1. ネオジム磁石を足裏の穴に入れる（各足2個）
   - **極性を揃える**（両足とも同じ面が下になるように）
2. 重りを中央の穴に入れる
3. 脚ボーンを足裏に差し込む

---

## Step 7: 電子部品の配線

### 7-1. ESP32への接続

1. GPIO13 ← 左腕サーボ信号線
2. GPIO12 ← 右腕サーボ信号線
3. GPIO14 ← 呼吸サーボ信号線
4. GND ← サーボGND共通線
5. VIN ← 電池ホルダー（+）

### 7-2. 電源接続

1. 電池ホルダー（+）→ ESP32 VIN、サーボVCC共通
2. 電池ホルダー（-）→ ESP32 GND、サーボGND共通

### 7-3. 配線の処理

1. 熱収縮チューブで接続部を保護
2. 配線を骨格に沿わせてまとめる
3. 結束バンドで固定

---

## Step 8: ファームウェアの書き込み

### 8-1. 開発環境

1. PlatformIO をインストール
2. `firmware/nuibone_esp32` フォルダを開く

### 8-2. 書き込み

1. ESP32をUSBで接続
2. `platformio.ini` で正しいボードを選択
3. ビルド & アップロード

### 8-3. 動作確認

1. シリアルモニタを開く（115200bps）
2. 「NuiBone Starting」「Ready」が表示されることを確認

---

## Step 9: ぬいぐるみへの挿入

### 9-1. 準備

1. ぬいぐるみの背中の縫い目を開く
2. 中の綿を取り出す（後で戻す）

### 9-2. 骨格の挿入

1. 足から先に入れる
2. 胴体を中央に配置
3. 腕が袖に入るよう調整
4. 呼吸プレートが胸の位置に来るよう配置

### 9-3. 電池ホルダーの配置

1. 背中または腰の位置に配置
2. スイッチが操作しやすい位置に
3. 電池交換しやすいように配置

### 9-4. 綿の戻し

1. 骨格の周りに綿を詰める
2. 形を整える
3. 縫い目を閉じる（マジックテープ推奨）

---

## Step 10: 動作テスト

### 10-1. アプリのインストール

1. Flutterアプリをビルド
2. スマホにインストール

### 10-2. 接続テスト

1. NuiBoneの電源をON
2. アプリを起動
3. 「デバイスを探す」をタップ
4. 「NuiBone」を選択して接続

### 10-3. 動作テスト

1. 「右手」ボタンで右腕が動くか確認
2. 「左手」ボタンで左腕が動くか確認
3. 「呼吸ON」で胸が上下するか確認
4. 「元気」で全部動くか確認

---

## トラブルシューティング

| 問題 | 原因 | 解決策 |
|------|------|--------|
| サーボが動かない | 配線ミス | 配線図を再確認 |
| サーボがガクガク | 電池切れ | 新しい電池に交換 |
| BLE接続できない | ファームウェア | シリアルで確認 |
| 腕の動きが逆 | サーボの向き | マウントの向きを確認 |
| 呼吸が大きすぎる | ストローク設定 | ファームウェアの角度調整 |

---

## 完成！

おめでとうございます！
NuiBoneが完成しました。

スマホアプリから操作して、ぬいぐるみに命を吹き込みましょう！
